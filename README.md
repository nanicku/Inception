# Inception

This project aims to broaden your knowledge of system administration by using Docker.
You will virtualize several Docker images, creating them in your new personal virtual
machine.

Docker 

- это платформа для разработки, развертывания и запуска приложений внутри контейнеров.
- это операционная система для контейнеров. 
- и в целом экономит средства, оптимизируя использование ресурсов. 
- в основе работы Docker лежит стандартизированный способ исполнения кода.
- в Docker используется архитектура клиент/сервер, в соответствии с которой клиент взаимодействует с демоном Docker, а тот предоставляет все необходимые клиенту услуги.
- можно быстро развертывать и масштабировать приложения в любой среде и сохранять уверенность в том, что код будет работать.
- упаковывает ПО в стандартизованные блоки, которые называются контейнерами. Каждый контейнер включает все необходимое для работы приложения: библиотеки, системные инструменты, код и среду исполнения.
- это технология с открытым исходным кодом, которая решает проблемы развертывания и масштабирования путем отделения приложений от зависимостей инфраструктуры.
- она решает эти проблемы благодаря применению контейнеров, позволяющих упаковать приложение со всеми его зависимостями, включая структуру каталогов, метаданные, пространство процессов, номера сетевых портов и т. д. Приложение, упакованное в контейнер, запускается одинаково на любых машинах и в любых окружениях. 
- это инструмент с открытым исходным кодом, который позволяет вам включать и хранить ваш код и его зависимости в удобном пакете, который называется образом. Затем этот образ можно использовать для создания экземпляра вашего приложения (сервиса) - контейнера. 

Docker отлично справляется с созданием и управлением образами и небольшим количеством контейнеров, однако современные инфраструктуры состоят из 100 микросервисов, для их менеджмента используется Kubernetes. 

Представим экосистему Docker:

Daemon Docker (Сервер):

- Выполняется в хост-системе и управляет всеми запущенными контейнерами. 
- Docker Daemon — это сервер Docker, который прослушивает запросы Docker API. 
- Docker Daemon управляет образами, контейнерами, сетями и томами.

Docker Container (Контейнер): 

- Основное различие между контейнерами и виртуальными машинами заключается в том, что контейнеры охватывают только уровень приложения и полагаются на базовое ядро операционной системы, в случае виртуальной машины создается новый экземпляр операционной системы.
- Run docker container. Флаг -d используется для запуска контейнера в фоновом режиме.
- контейнеры создают виртуальное представление серверной операционной системы. 
- Автономная виртуальная система, содержащая выполняющийся процесс, все файлы, зависимости, адресное пространство процесса и сетевые порты, необходимые приложению. Так как каждый контейнер имеет свое пространство портов, следует организовать их отображение в фактические порты на уровне Docker;
- docker run image_name создает и запускает контейнер из образа. В отличие от виртуальных машин, контейнеры не требуют собственной операционной системы — это всего лишь обертки вокруг процессов UNIX, которые непосредственно взаимодействуют с ядром. 
- одно приложение ничего не знает о существовании других приложений. Но все процессы используют одно и то же ядро операционной системы.
- По умолчанию все изменения внутри контейнера теряются при остановке контейнера. Если мы хотим сохранить данные между запусками, могут помочь Docker Volume. Таким образом, любое изменение файла внутри контейнера создает рабочую копию на уровне чтения-записи. Однако, когда контейнер останавливается или удаляется, этот уровень чтения-записи теряется. 
- Volumes — это предпочтительный механизм сохранения данных, генерируемых и используемых контейнерами Docker.
- Когда мы запускаем новый контейнер, Docker добавляет слой чтения-записи поверх слоев image, позволяя контейнеру работать как в стандартной файловой системе Linux 
- порты:
Docker не открывает порты по умолчанию, вы должны настроить каждый открытый порт самостоятельно! использовать флаг -p команды docker run: 
	docker run -p <port_number_on_host>:<port_number_on_container> <image> или 
	docker run -v <порт_на_хосте>:<порт_в_контейнере> <образ>
Из-за того, что многие контейнеры связаны с одним хостом, когда служба уже запущена на порту на хосте, мы не можем запустить другой контейнер с этим же портом. Следовательно, чтобы запустить другой экземпляр мы должны выбрать порт, который не используется. Открытие всех портов Docker, как правило, не является хорошей идеей, поскольку по умолчанию все порты закрыты.
Чтобы открыть только один порт, выполните следующую строку:
	doker container run -p 8080:80 -d nginx  Порт 80 контейнера Nginx доступен для внешнего мира через порт хоста 8080.
По умолчанию Docker предоставляет порты контейнера IP-адресу 0.0.0.0 (это соответствует любому IP-адресу в системе). Вы также можете указать Docker, какой IP-адрес нужно привязать. Это может быть 127.0.0.1 или другой IP-адрес.
Чтобы привязать порт 80 контейнера Docker к порту 8000 хост-системы и IP-адресу 127.0.0.1 (он же localhost), просто выполните следующую команду:
	docker run -d -p 127.0.0.1:8000:80 nginx

Основные команды для работы с контейнерами
-t — предоставляет доступ к терминалу внутри контейнера.
-i — делает возможным взаимодействие с терминалом внутри контейнера.
-d — запуск контейнер в фоновом режиме. Это позволяет использовать терминал, из которого запущен контейнер, для выполнения других команд во время работы контейнера.
--rm — автоматическое удаление контейнера после завершения его работы.

- Просмотреть список запущенных контейнеров можно командой docker ps. Однако в таком виде команда вернёт список только запущенных контейнеров, чтобы вывести список всех контейнеров, в том числе и остановленных, нужно указать ключ -a. Еще один полезный ключ для отображения списка контейнеров: -q. Он выводит только ID контейнеров.
- Для удаления контейнера применяется команда docker rm имя/id контейнера. Если нужно удалить все контейнеры можно применить связку команд: docker rm $(docker ps -qa).
Удалить все не связанные с контейнерами ресурсы (образы, контейнеры, тома и сети) можно командой docker system prune. Если требуется удалить все остановленные контейнеры и неиспользуемые образы можно воспользоваться командой docker system prune -a.

Docker Client (Клиент): 

- Пользовательский интерфейс, или интерфейс командной строки, для взаимодействий с демоном Docker.
- Клиент Docker — это основной способ взаимодействия с Docker.
- Когда вы используете интерфейс командной строки (CLI) Docker, вы вводите в терминал команду, которая начинается с docker.
 -Затем клиент Docker использует API Docker для отправки команды демону Docker.

Docker Image (Образ): 

- это шаблон только для чтения, который содержит набор инструкций по созданию контейнера, который может работать на платформе Docker.
- Он предоставляет удобный способ упаковать приложения и предварительно настроенные серверные среды, которые вы можете использовать для личного использования или публично публиковать с другими пользователями Docker.
- Также можно воспользоваться командой docker diff, чтобы увидеть различия между двумя образами.
- Каждый образ состоит из нескольких уровней, или слоев, которые могут совместно использоваться несколькими образами.
- С физической точки зрения docker image состоит из набора слоев, доступных только для чтения (read-only layers).
- Каждый слой image является результатом одной команды в файле Dockerfile.
- Образ докера представляет собой сжатый (tar) файл, содержащий серию слоев.
- Каждый дополнительный слой image включает только набор отличий от предыдущего слоя (попробуйте запустить для docker image команду docker history, которая выведет все его слои и те команды, которые их создало). В нем описываются пошаговые инструкции по всем командам, которые необходимо выполнить для сборки образа Docker.
- Docker образ — это шаблон (физически — исполняемый пакет), из которого создаются Docker-контейнеры. 
Что нужно знать о Docker-образах:
Образ — это только шаблон для создания контейнеров.
В основе любого образа лежит родительский образ, который, как правило, содержит ОС.
Образ состоит из слоев.
Каждая команда в Dockerfile создаёт новый слой.
Образы можно переиспользовать много раз.
Образы можно загружать в удаленный репозиторий.

Реестр Docker:

- Репозиторий для хранения и распространения образов контейнеров Docker. Пример известного реестра — Docker Hub, куда можно помещать и откуда можно извлекать образы. Docker Hub — это облачная служба реестра, которая позволяет загружать образы Docker, созданные другими сообществами. Вы также можете загрузить свои собственные образы, созданные Docker, в Docker Hub.

Dockerfile:

- Это очень простой текстовый файл, содержащий команды, которые выполняют сборку образов Docker. 
- с использованием специального синтаксиса.
- Посредством этих команд можно устанавливать дополнительные программные компоненты, настраивать переменные окружения, рабочие каталоги и точку входа ENTRYPOINT, а также добавлять новый код;
- Команда docker build обрабатывает этот файл, создавая образ Docker в вашем локальном кэше образов, который затем можно запустить с помощью docker run команды или отправить в постоянный репозиторий образов (push).
- это файл с инструкциями о том, как Docker должны строить свой image.

CMD — это команда, которая будет запускаться при запуске контейнера
ENTRYPOINT — устанавливает приложение по умолчанию, используемое каждый раз, когда контейнер создается из образа. Если используется вместе с CMD, вы можете удалить приложение и просто определить там аргументы
ENV — установка / изменение переменных среды в контейнерах, созданных из образа. Задает переменные среды внутри образа, на которые могут ссылаться другие инструкции. ENV часто применяется для передачи информации в контейнеризированное приложение через переменные среды.
ARG Задает переменные, значение которых передается докером во время сборки образа. В отличие от ENV-переменных, ARG-переменные недоступны во время выполнения контейнера.
EXPOSE — Определите, какие порты контейнера открывать. Указывает планируемый рабочий порт у контейнера. Инструкция сама по себе не открывает порт. Чтобы использовался указанный в EXPOSE порт — нужно указать docker run -P при запуске контейнера. Если требуется пробросить и сопоставить разные порты внутри и снаружи контейнера используется docker run -p внутренний порт:внешний порт. 
FROM — Выберите базовый образ, чтобы построить новый образ поверх
RUN — укажите команды для внесения изменений в ваш образ, а затем контейнеры, запускаемые с этого образа. Это включает в себя обновление пакетов, установку программного обеспечения, добавление пользователей, создание исходной базы данных, настройку сертификатов и т. д. Это команды, которые вы должны запускаться из командной строки для установки и настройки вашего приложения. Это одна из самых важных директив dockerfile но стоит помнить, что каждая инструкция создает свой слой, поэтому хорошей практикой является запись цепочки команд через &&: RUN comand_1 && comand_2 && comand_3.
VOLUME Просмотреть существующие тома можно командой docker volume ls. создает точку монтирования в контейнере, связывая ее с файловыми системами, доступными хосту Docker. Новые тома заполняются уже существующим содержимым указанного места на image. Особенно уместно упомянуть, что определение томов в Dockerfile может привести к проблемам. Томами следует управлять с помощью команд docker-compose или docker run. Volumes не являются обязательными. Если у вашего приложения нет состояния (и большинство веб-приложений работают так), вам не нужно использовать тома. 
USER — Определите пользователя по умолчанию, все команды будут запускаться, как в любом контейнере, созданном из вашего образа. Это может быть либо UID, либо имя пользователя.
WORKDIR — Определите рабочий каталог по умолчанию для команды, определенной в инструкциях «ENTRYPOINT» или «CMD».
COPY Копирует файлы и папки из текущей директории, где находится пользователь в указанную директорию в контейнере
ADD Копирует файлы и папки из текущей позиции пользователя, скачивает файлы по URL и работает с tar-архивами.
Аргументы docker run переопределяют CMD.

Docker Swarm:

По сути своей, это готовый к использованию механизм кластеризации, позволяющий объединить несколько узлов Docker в один большой хост Docker.

Docker Compose:

- инструмент, который упрощает запуск приложений, состоящих из нескольких контейнеров. Приложения часто состоят из множества компонентов, и соответственно они будут выполняться в нескольких контейнерах.
- В состав Docker входит инструмент Compose
- с помощью которого можно легко запустить приложение в нескольких контейнерах.
- Вы можете определить окружение для приложения в общем файле Dockerfile и определить перечень служб в файле docker-compose.yml, после чего Docker автоматически будет создавать и запускать необходимые контейнеры, как определено в этих файлах.
- В docker-compose.yml, volumes может появляться в двух разных местах: # Вложенный ключ. Настраивает тома для определенной службы. # Ключ верхнего уровня. Объявляет тома, на которые можно ссылаться из нескольких сервисов.
- в docker-compose.yml файл для повторного использования.
- Интерфейс командной строки Docker Compose (cli) упрощает взаимодействие с вашим многоконтейнерным приложением.
- Docker Compose поставляется бесплатно с установленным вами Docker.
Docker-compose — это надстройка над докером, приложение написанное на Python, которое позволяет запускать множество контейнеров одновременно и маршрутизировать потоки данных между ними.
- Для каждого проекта (кластера контейнеров) Docker создаёт свою сеть, где контейнеры могут обращаться друг к другу по именам, которые мы укажем в docker-compose.yml. Все настройки запуска кластера контейнеров находятся в этом же файле, который располагается в корневой директории проекта.
- YAML — один из самых распространенных языков записи конфигураций и сценариев для сетевых приложений.
- Список — это набор разнородных данных. Списки могут быть простыми (одномерными), вложенными (вложенными) и именованными. 
- это файл Docker-Compose, который содежит инструкции, используемые для запуска и настройки сервисов (отдельных контейнеров нашего многоконтейнерного приложения).
